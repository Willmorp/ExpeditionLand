var geoip2=function(){function Lookup(successCallback,errorCallback,options,type){this.successCallback=successCallback,this.errorCallback=errorCallback,this.geolocation=options&&options.hasOwnProperty("geolocation")?options.geolocation:navigator.geolocation,this.type=type}var exports={};Lookup.prototype.returnSuccess=function(location){this.successCallback&&"function"==typeof this.successCallback&&this.successCallback(this.fillInObject(this.objectFromJSON(location)))},Lookup.prototype.returnError=function(error){this.errorCallback&&"function"==typeof this.errorCallback&&(error||(error={error:"Unknown error"}),this.errorCallback(error))},Lookup.prototype.objectFromJSON=function(json){return"undefined"!=typeof window.JSON&&"function"==typeof window.JSON.parse?window.JSON.parse(json):eval("("+json+")")};var fillIns={country:[["continent","Object","names","Object"],["country","Object","names","Object"],["registered_country","Object","names","Object"],["represented_country","Object","names","Object"],["traits","Object"]],city:[["city","Object","names","Object"],["continent","Object","names","Object"],["country","Object","names","Object"],["location","Object"],["postal","Object"],["registered_country","Object","names","Object"],["represented_country","Object","names","Object"],["subdivisions","Array",0,"Object","names","Object"],["traits","Object"]]};return Lookup.prototype.fillInObject=function(obj){for(var fill="country"===this.type?fillIns.country:fillIns.city,i=0;i<fill.length;i++){for(var path=fill[i],o=obj,j=0;j<path.length;j+=2){var key=path[j];o[key]||(o[key]="Object"===path[j+1]?{}:[]),o=o[key]}}try{Object.defineProperty(obj.continent,"continent_code",{enumerable:!1,get:function(){return this.code},set:function(value){this.code=value}})}catch(e){obj.continent.code&&(obj.continent.continent_code=obj.continent.code)}if("country"!==this.type){try{Object.defineProperty(obj,"most_specific_subdivision",{enumerable:!1,get:function(){return this.subdivisions[this.subdivisions.length-1]},set:function(value){this.subdivisions[this.subdivisions.length-1]=value}})}catch(e){obj.most_specific_subdivision=obj.subdivisions[obj.subdivisions.length-1]}}return obj},Lookup.prototype.getGeoIPResult=function(){var param,request,that=this,uri="//js.maxmind.com/geoip/v2.1/"+this.type+"/me?",httpParams={referrer:location.protocol+"//"+location.hostname};if(!this.alreadyRan){this.alreadyRan=1,"Microsoft Internet Explorer"===navigator.appName&&window.XDomainRequest&&-1===navigator.appVersion.indexOf("MSIE 1")?(request=new XDomainRequest,uri=window.location.protocol+uri,request.onprogress=function(){}):(request=new window.XMLHttpRequest,uri="https:"+uri);for(param in httpParams){httpParams.hasOwnProperty(param)&&httpParams[param]&&(uri+=param+"="+encodeURIComponent(httpParams[param])+"&")}uri=uri.substring(0,uri.length-1),request.open("GET",uri,!0),request.onload=function(){if("undefined"==typeof request.status||200===request.status){that.returnSuccess(request.responseText)}else{var error,contentType=request.hasOwnProperty("contentType")?request.contentType:request.getResponseHeader("Content-Type");if(/json/.test(contentType)&&request.responseText.length){try{error=that.objectFromJSON(request.responseText)}catch(e){error={code:"HTTP_ERROR",error:"The server returned a "+request.status+" status with an invalid JSON body."}}}else{error=request.responseText.length?{code:"HTTP_ERROR",error:"The server returned a "+request.status+" status with the following body: "+request.responseText}:{code:"HTTP_ERROR",error:"The server returned a "+request.status+" status but either the server did not return a body or this browser is a version of Internet Explorer that hides error bodies."}}that.returnError(error)}},request.ontimeout=function(){that.returnError({code:"HTTP_TIMEOUT",error:"The request to the GeoIP2 web service timed out."})},request.onerror=function(){that.returnError({code:"HTTP_ERROR",error:"There was an error making the request to the GeoIP2 web service."})},request.send(null)}},exports.country=function(successCallback,errorCallback,options){var l=new Lookup(successCallback,errorCallback,options,"country");l.getGeoIPResult()},exports.city=function(successCallback,errorCallback,options){var l=new Lookup(successCallback,errorCallback,options,"city");l.getGeoIPResult()},exports.insights=function(successCallback,errorCallback,options){var l=new Lookup(successCallback,errorCallback,options,"insights");l.getGeoIPResult()},exports}();function getcountryddl(){var c=$("#getcountry"),d=new serviceProxy({show:false}),e=$("#footerCulture").val(),a="",b="source=DreamTrips";if($("#domainurl").val().length!=0){a=$("#domainurl").val()}else{a=window.location.origin}if(e==undefined||e==""){e=$("#hdnbrowserlanguagecode").val().toUpperCase()+"-"+$("#hdngetcountrycode").val().toUpperCase()}d.invoke(a+"/Marketing/GetLocales/","POST",b,function(h){var f=JSON.parse(h);c.empty();if($("#hdnIsUserLoggedin").val()=="true"){if($("#hdnIsMalaysianSite").val()=="true"){for(i=0;i<f.length;i++){if(f[i].Country.CountryCode=="MY"){c.append($("<option name="+f[i].Country.CountryCode+" languagecode="+f[i].Language.LanguageCode+" locale="+f[i].Language.LanguageCode+"-"+f[i].Country.CountryCode+"></option>").val(f[i].Country.FullName).html(f[i].Country.FullName+" ("+f[i].Language.LanguageNameNative+")"))}}c.append('<option name="MY" languagecode="MS" locale="MS-MY" value="Malaysia">Malaysia (Malay)</option>')}else{for(i=0;i<f.length;i++){if(f[i].Country.CountryCode==$("#hdncountrycode").val()&&(f[i].Language.LanguageCode!="SR"&&f[i].Language.LanguageCode!="RU")){c.append($("<option name="+f[i].Country.CountryCode+" languagecode="+f[i].Language.LanguageCode+" locale="+f[i].Language.LanguageCode+"-"+f[i].Country.CountryCode+"></option>").val(f[i].Country.FullName).html(f[i].Country.FullName+" ("+f[i].Language.LanguageNameNative+")"))}}if($("#hdngetcountrycode").val()=="MY"){c.append('<option name="MY" languagecode="MS" locale="MS-MY" value="Malaysia">Malaysia (Malay)</option>')}}}else{if($("#hdnIsMalaysianSite").val()=="true"){for(i=0;i<f.length;i++){if(f[i].Country.CountryCode=="MY"){c.append($("<option name="+f[i].Country.CountryCode+" languagecode="+f[i].Language.LanguageCode+" locale="+f[i].Language.LanguageCode+"-"+f[i].Country.CountryCode+"></option>").val(f[i].Country.FullName).html(f[i].Country.FullName+" ("+f[i].Language.LanguageNameNative+")"))}}c.append('<option name="MY" languagecode="MS" locale="MS-MY" value="Malaysia">Malaysia (Malay)</option>')}else{for(i=0;i<f.length;i++){if(f[i].Language.LanguageCode!="SR"&&f[i].Language.LanguageCode!="RU"){c.append($("<option name="+f[i].Country.CountryCode+" languagecode="+f[i].Language.LanguageCode+" locale="+f[i].Language.LanguageCode+"-"+f[i].Country.CountryCode+"></option>").val(f[i].Country.FullName).html(f[i].Country.FullName+" ("+f[i].Language.LanguageNameNative+")"))}}c.append('<option name="MY" languagecode="MS" locale="MS-MY" value="Malaysia">Malaysia (Malay)</option>')}}var g=$("#getcountry option");g.sort(function(k,j){if(k.text.toUpperCase()>j.text.toUpperCase()){return 1}else{if(k.text.toUpperCase()<j.text.toUpperCase()){return -1}else{return 0}}});$("#getcountry").empty().append(g);if($("#hdngetcountrycode").val()!=""){$("#getcountry option").each(function(){if($("#hdnIsUserLoggedin").val()=="true"){var m=$("#hdnlanguagecode").val();if($(this).attr("name")==$("#hdngetcountrycode").val()&&$(this).attr("languagecode").toLowerCase()==m.toLowerCase()){$("#getcountry option[languagecode="+m.toUpperCase()+"]").attr("selected",true);return false}else{if(e!=""||e!=undefined){var l=e.substr(0,2);var k=e.substr(3,4);if($(this).attr("locale")!=undefined&&$(this).attr("locale").toLowerCase()==e.toLowerCase()){var j=$("#getcountry").find("option[locale="+e+"]").index();document.getElementById("getcountry").options[j].selected=true;return false}else{if($(this).attr("name")==k&&$(this).attr("languagecode").toLowerCase()==l.toLowerCase()){$("#getcountry option[name="+k+"]").attr("selected",true);return false}}}else{if($(this).attr("name")==$("#hdngetcountrycode").val()){$("#getcountry option[name="+$("#hdngetcountrycode").val()+"]").attr("selected",true)}else{$("#getcountry option[value='country']").attr("selected",true)}}}}else{if($("#hdnIsMalaysianSite").val()=="true"){var m="en";if($("#hdngetcountrycode").val()=="MY"){m=$("#hdnlanguagecode").val()}if(m==""){m="en"}$("#getcountry option[languagecode="+m.toUpperCase()+"]").attr("selected",true)}else{var m=$("#hdnbrowserlanguagecode").val();if(e!=""||e!=undefined){var l=e.substr(0,2);var k=e.substr(3,4);if($(this).attr("locale")!=undefined&&$(this).attr("locale").toLowerCase()==e.toLowerCase()){var j=$("#getcountry").find("option[locale="+e+"]").index();document.getElementById("getcountry").options[j].selected=true;return false}else{if($(this).attr("name")==k&&$(this).attr("languagecode").toLowerCase()==l.toLowerCase()){$("#getcountry option[name="+k+"]").attr("selected",true);return false}}}if($(this).attr("name")==$("#hdngetcountrycode").val()&&$(this).attr("languagecode").toLowerCase()==m.toLowerCase()){$("#getcountry option[languagecode="+m.toUpperCase()+"]").attr("selected",true);return false}else{$("#getcountry option[value='country']").attr("selected",true)}}}})}else{$("#getcountry option[value='country']").attr("selected",true)}});if(($("#packagecheckout").val()!=undefined&&$("#packagecheckout").val()=="packagecheckout")||($("#packageconfirm").val()!=undefined&&$("#packageconfirm").val()=="packageconfirm")){$("#getcountry").prop("disabled",true)}else{if(($("#duePaymentcheckout").val()!=undefined&&$("#duePaymentcheckout").val()=="duePaymentcheckout")){$("#getcountry").prop("disabled",true)}else{if(($("#duePaymentResponse").val()!=undefined&&$("#duePaymentResponse").val()=="duePaymentResponse")){$("#getcountry").prop("disabled",true)}else{if(($("#cartConfirmationPage").val()!=undefined&&$("#cartConfirmationPage").val()=="cartConfirmationPage")){$("#getcountry").prop("disabled",true)}else{$("#getcountry").prop("disabled",false)}}}}return false}function onchangeUpdatefootermenu(e){$("#footermenulist").empty();$("#address").empty();$("#phone").empty();$("#FAQ").empty();$("#internationalcontact").empty();var b="";var f=$("#getcountry Option:selected").attr("languagecode");if($("#hdnIsUserLoggedin").val()!="true"){if($("#getcountry Option:selected").attr("name")!=undefined&&$("#getcountry Option:selected").attr("name")!=""){b=$("#getcountry Option:selected").attr("name");$("#hdnCountrycodeOTA").val(b);ajaxcallPdffooter(b,f);footeraddressandphone(b,f);footerFAQ(b,f);getcopyrights(b,f)}if($("#getcountry Option:selected").val()=="country"||$("#getcountry Option:selected").val()==""||$("#getcountry Option:selected").val()==undefined){b=$("#hdngetcountrycode").val();f=$("#hdnbrowserlanguagecode").val();$("#hdnCountrycodeOTA").val(b);ajaxcallPdffooter(b,f);footeraddressandphone(b,f);footerFAQ(b,f);getcopyrights(b,f);if(b==""||b==undefined){$("#hdncountrycode").val("");var d=function(g){$("#hdnCountrycodeOTA").val(g.registered_country.iso_code);ajaxcallPdffooter(g.registered_country.iso_code,f);footeraddressandphone(g.registered_country.iso_code,f);footerFAQ(g.registered_country.iso_code,f);getcopyrights(g.registered_country.iso_code,f)};var a=function(g){$("#hdncountrycode").val("")};geoip2.country(d,onerror)}}}else{if(b==""||b==undefined){b=$("#hdncountrycode").val();f=$("#hdnlanguagecode").val();$("#hdnCountrycodeOTA").val($("#hdncountrycode").val());ajaxcallPdffooter(b,f);footeraddressandphone(b,f);footerFAQ(b,f);getcopyrights(b,f)}if(b==""){b=$("#hdngetcountrycode").val();f=$("#hdnbrowserlanguagecode").val();$("#hdnCountrycodeOTA").val(b);ajaxcallPdffooter(b,f);footeraddressandphone(b,f);getcopyrights(b,f);if(b==""||b==undefined){$("#hdncountrycode").val("");var d=function(g){$("#hdnCountrycodeOTA").val(g.registered_country.iso_code);ajaxcallPdffooter(g.registered_country.iso_code,f);footeraddressandphone(g.registered_country.iso_code,f);footerFAQ(g.registered_country.iso_code,f);getcopyrights(b,f)};var a=function(g){$("#hdncountrycode").val("")};geoip2.country(d,onerror)}}}dailydealsblock(e);var c=$("#hdnBecomeAMember");if(c.length){becomeMemberCountryChange()}}function priceomparison(a){if(a=="AU"){$("#FooterPriceComparison").css("display","none")}else{$("#FooterPriceComparison").css("display","block")}}function dailydealsblock(a){if($("#hdnIsUserLoggedinhomedetails").val()!="true"){$(".ExclusiveDeals").removeClass("Dealscol1").removeClass("Dealscol2").removeClass("Dealscol3");var c=$("#getcountry option:Selected").val(),b=$("#hdngetcountrycode").val();if(c=="Puerto Rico"||c=="Canada"){$(".homedetails").css("display","block");$(".ExclusiveDeals").addClass("Dealscol3")}else{if((b=="PR"||b=="CA")&&($(a).prop("type")==undefined||$(a).prop("type").indexOf("select")<0)){$(".homedetails").css("display","block");$(".ExclusiveDeals").addClass("Dealscol3")}else{$(".homedetails").css("display","none");$(".ExclusiveDeals").addClass("Dealscol1")}}if(c=="United States"||(b=="US"&&($(a).prop("type")==undefined||$(a).prop("type").indexOf("select")<0))){$(".DailyDeals").css("display","block");$(".homedetails").css("display","block");$(".ExclusiveDeals").removeClass("Dealscol1")}else{$(".DailyDeals").css("display","none")}b=$("#getcountry option:Selected").val()}else{if($("#hdnGOLDUser").val()=="Gold"||$("#hdnPlatUser").val()=="Platinum"||$("#hdnSTDUser").val()=="Standard"){if($("#hdncountrycode").val()=="PR"||$("#hdncountrycode").val()=="CA"){if($("#hdnSTDUser").val()=="Standard"){$(".homedetails").css("display","block")}$(".ExclusiveDeals").addClass("Dealscol3")}else{if($("#hdncountrycode").val()=="US"){if($("#hdnSTDUser").val()=="Standard"){$(".homedetails").css("display","block")}}else{$(".homedetails").css("display","none");$(".ExclusiveDeals").addClass("Dealscol1")}}if($("#hdncountrycode").val()=="US"){$(".DailyDeals").css("display","block")}else{$(".DailyDeals").css("display","none")}}else{if($("#hdnPrefferedUser").val()=="Preffered"){if($("#hdncountrycode").val()=="US"){$(".homedetails").css("display","block");$(".ExclusiveDeals").css("display","block")}else{$(".homedetails").css("display","none");$(".ExclusiveDeals").css("display","none")}if($("#hdncountrycode").val()=="US"){$(".DailyDeals").css("display","block")}else{$(".DailyDeals").css("display","none")}}}}}function ajaxcallformalaysia(g){$.blockUI({message:'<h1><i class="fa fa-cog fa-spin"></i> '+$("#hdnJustAMomentMessage").val()+"</h1>",showOverlay:true});var h=$("#getcountry Option:selected").attr("languagecode");var b=$("#getcountry Option:selected").attr("name");if(h==undefined){h=""}$("#hdnlanguagecode").val($("#getcountry Option:selected").attr("languagecode"));var f=$("#getcountry option:Selected").attr("locale");var e="DTCom";if($("#hdnIsMalaysianSite").val()=="true"){e="DTMY_skyzone"}var d="";if($("#domainurl").val().length!=0){d=$("#domainurl").val()}else{d=window.location.origin}var c="country="+b+"&documenttype="+e+"&languagecode="+h+"&locale="+f;var a=true;$.ajax({type:"POST",url:"/Marketing/ValidateCountrySite/",data:c,success:function(j){if(j.response.IsRedirect){var k=j.response.URL+window.location.pathname;if(window.location.search!=null&&window.location.search!="undefined"&&window.location.search!=""){k+=window.location.search+"&locale="+f}else{k+="?locale="+f}window.location.href=k;a=false}else{onchangeUpdatefootermenu(g);multilanguagetext()}},error:function(k,l,j){$.unblockUI();alert(j)}});return a}function ajaxcallPdffooter(a,g){$("#footermenulist").empty();var f=$("#footermenulist");var c=new serviceProxy({show:false});if(g==undefined){g=""}var e="DTCom";if($("#hdnIsMalaysianSite").val()=="true"){e="DTMY_skyzone"}var d="";if($("#domainurl").length>0){d=$("#domainurl").val()}else{d=window.location.origin}var b="country="+a+"&documenttype="+e+"&languagecode="+g;c.invoke(d+"/Marketing/GetWebsiteDocumentsByCountry/","POST",b,function(l){var j=JSON.parse(l);if(j.Documents!=null){for(var h=0;h<j.Documents.length;h++){var k=true;switch(j.Documents[h].Name){case"Terms and Conditions":if($("#hdngetcountrycode").val()=="CN"){k=false}break;case"Rovia Booking Terms":if($("#hdngetcountrycode").val()=="MX"){k=false}case"OTA Redemption Form":if($("#hdnIsUserLoggedin").val()!="true"){k=false}break;default:k=true;break}if(k){if(j.Documents[h].Name=="Cookie Policy"){if(typeof $.cookie("the_cookie_policy")!=="undefinied"&&$.cookie("the_cookie_policy")==$("#hdncountrycode").val()){$("#closeCookies").remove()}else{$("#hdncookieurl").val(j.Documents[h].Url);$("#CookiePolicyBanner").attr("target","_blank").attr("href",j.Documents[h].Url)}}f.append("<li><a target='_blank' href='"+j.Documents[h].Url+"'> "+j.Documents[h].NameNative+"</a></li>")}}}},null,null,false);return false}function getcopyrights(e,a){if(a==undefined){a=""}$(".Copyrightfooter").empty();var c="";if($("#hdnIsMalaysianSite").val()=="true"){c="country="+e+"&poe=DTMY&languagecode="+a}else{c="country="+e+"&poe=DreamTrips&languagecode="+a}var d="";if($("#domainurl").length>0){d=$("#domainurl").val()}else{d=window.location.origin}var b=new serviceProxy({show:false});b.invoke(d+"/Marketing/GetCopyrightInfo/","POST",c,function(g){var f=JSON.parse(g);for(i=0;i<f.length;i++){$(".Copyrightfooter").append(f[i].Copyright)}},null,null,false);return false}function footeraddressandphone(e,a){if(a==undefined){a=""}var d="";if($("#domainurl").length>0){d=$("#domainurl").val()}else{d=window.location.origin}$("#address").empty();$("#phone").empty();var c=new serviceProxy({show:false});var b="";if($("#hdnIsMalaysianSite").val()=="true"&&$("#hdnIsProfilePage").val()=="false"){b="country="+e+"&poe=DTMY&languagecode="+a}else{b="country="+e+"&poe=DreamTrips&languagecode="+a}c.invoke(d+"/Marketing/GetWebsiteContactByCountry/","POST",b,function(h){var g=JSON.parse(h);for(var f=0;f<g.length;f++){$("#address").append(g[f].FormattedAddress);if(g[f].Phone!=null&&g[f].Phone!=""&&g[f].Phone!="null"){$("#phone").append(g[f].Phone)}else{$(".phoneNum").hide()}break}},null,null,false);return false}function footerFAQ(e,a){if(a==undefined){a=""}$("#FAQ").empty();$("#internationalcontact").empty();var d="";if($("#domainurl").length>0){d=$("#domainurl").val()}else{d=window.location.origin}var c=new serviceProxy({show:false});var b="country="+e+"&documenttype=DTCom_Content&languagecode="+a;c.invoke(d+"/Marketing/GetWebsiteDocumentsByCountry/","POST",b,function(h){var g=JSON.parse(h);if(g.Documents!=null){for(var f=0;f<g.Documents.length;f++){if(g.Documents[f].Name=="WebsiteFAQ"){$("#FAQ").append("<a target='_blank' href='"+g.Documents[f].Url+"'> "+g.Documents[f].NameNative+"</a>")}if(g.Documents[f].Name=="International Travel Support"){$("#internationalcontact").append("<a target='_blank' href='"+g.Documents[f].Url+"'>"+g.Documents[f].NameNative+"</a>")}}}},null,null,false);return false}function multilanguagetext(){var a="";if($("#domainurl").val().length!=0){a=$("#domainurl").val()}else{a=window.location.origin}var b="";var c=$("#getcountry option:Selected").attr("locale");b=a+"/Package/ReturnLocale?locale="+c;if(c!="country"&&c!=undefined){var d="";var e=new serviceProxy({show:false});e.invoke(b,"POST",d,function(f){window.location=window.location.pathname},null,null,false)}}function SetReturnUrlOnRewardsLogin(){$("#returnUrlOnRewardsAlreadyMember").val("/profile/MyProfileInformation")}if(typeof $.cookie("the_cookie_policy")!=="undefinied"&&$.cookie("the_cookie_policy")==$("#hdncountrycode").val()){$("#closeCookies").remove()}$(document).ready(function(a){a("#cookie-close-button").click(function(){a("#closeCookies").remove();a.cookie("the_cookie_policy",a("#hdncountrycode").val())})});